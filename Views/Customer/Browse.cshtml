@model IEnumerable<African_Beauty_Trading.Models.Product>

@{
    ViewBag.Title = "Browse Products";
}

<div class="container mt-5" style="max-width: 1400px;">
    <h2 class="fw-bold mb-4 text-center"
        style="font-size:2.5rem; color:#8B0000; letter-spacing:1px; text-transform:uppercase;">
        Eleganzeblen Collection
    </h2>

    <!-- Products Grid -->
    <div class="row">
        @foreach (var item in Model)
        {
            // Get available sizes for display
            var availableSizes = !string.IsNullOrEmpty(item.AvailableSizes)
                ? item.AvailableSizes.Split(',').ToList()
                : new List<string> { "One Size" };

            var displaySizes = availableSizes.Take(3).ToList(); // Show first 3 sizes
            var hasMoreSizes = availableSizes.Count > 3;

            <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                <div class="card h-100 product-card"
                     style="border:none; border-radius:16px; overflow:hidden;
                            box-shadow:0 8px 20px rgba(0,0,0,0.15); transition:all 0.3s ease;
                            background: linear-gradient(145deg, #ffffff, #f8f9fa);">

                    <!-- Product Image -->
                    <div style="position:relative; overflow:hidden; height:220px;">
                        <!-- FIXED: Use ImageUrl instead of ImagePath -->
                        <img src="@Url.Content(!string.IsNullOrEmpty(item.ImageUrl) ? item.ImageUrl : "~/Content/img/placeholder.png")"
                             alt="@item.Name"
                             style="width:100%; height:100%; object-fit:cover; border-radius:16px 16px 0 0;
                                    transition: transform 0.4s ease;"
                             onmouseover="this.style.transform='scale(1.1)'"
                             onmouseout="this.style.transform='scale(1)'"
                             onerror="this.src='@Url.Content("~/Content/img/placeholder.png")'" />

                        <!-- Category Badge -->
                        @if (item.Category != null)
                        {
                            <span style="position:absolute; top:10px; left:10px; background:#8B0000;
                                         color:white; padding:5px 12px; border-radius:20px;
                                         font-size:0.8rem; font-weight:bold;">
                                @item.Category.Name
                            </span>
                        }

                        <!-- Stock Badge -->
                        <span style="position:absolute; top:10px; right:10px;
                                     background:@(item.Stock > 0 ? "#28a745" : "#dc3545");
                                     color:white; padding:5px 10px; border-radius:15px;
                                     font-size:0.75rem; font-weight:bold;">
                            Stock: @item.Stock
                        </span>

                        <!-- Featured Badge -->
                        @if (item.Featured)
                        {
                            <span style="position:absolute; bottom:10px; left:10px; background:#ffc107;
                                         color:#000; padding:5px 10px; border-radius:15px;
                                         font-size:0.75rem; font-weight:bold;">
                                ⭐ Featured
                            </span>
                        }
                    </div>

                    <!-- Card Body -->
                    <div class="card-body d-flex flex-column"
                         style="padding:20px; display:flex; flex-direction:column;">

                        <h5 class="fw-bold" style="font-size:1.2rem; color:#222; margin-bottom:10px;">
                            @item.Name
                        </h5>

                        <p style="color:#666; font-size:0.85rem; margin-bottom:10px;">
                            @if (!string.IsNullOrEmpty(item.Description))
                            {
                                if (item.Description.Length > 100)
                                {
                                    @item.Description.Substring(0, 100)
                                    <text>...</text>
                                }
                                else
                                {
                                    @item.Description
                                }
                            }
                            else
                            {
                                <span class="text-muted">No description available</span>
                            }
                        </p>

                        <!-- Available Sizes Section -->
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <small class="fw-bold text-muted">AVAILABLE SIZES:</small>
                                @if (hasMoreSizes)
                                {
                                    <small class="text-primary" style="cursor: pointer;"
                                           data-bs-toggle="tooltip"
                                           data-bs-title="@string.Join(", ", availableSizes)">
                                        +@(availableSizes.Count - 3) more
                                    </small>
                                }
                            </div>
                            <div class="d-flex flex-wrap gap-1">
                                @foreach (var size in displaySizes)
                                {
                                    <span class="badge bg-light text-dark border"
                                          style="font-size:0.75rem; padding:4px 8px;">
                                        @size.Trim()
                                    </span>
                                }
                            </div>
                        </div>

                        <p style="color:#28a745; font-size:1.3rem; font-weight:bold; margin-bottom:12px;">
                            R @item.Price.ToString("N2")
                        </p>

                        <!-- Action Buttons -->
                        <div style="margin-top:auto; display:flex; gap:8px; flex-direction:column;">
                            @if (item.Stock > 0)
                            {
                                <div class="d-flex gap-2">
                                    @Html.ActionLink("View Details & Purchase", "Details", "Customer", new { id = item.Id },
                                        new
                                             {
                                                 @class = "btn btn-primary flex-fill",
                                              style = "border-radius:8px; font-weight:600; font-size:0.9rem;"
                                             })
                                </div>
                            }
                            else
                            {
                                <div class="d-flex gap-2">
                                    <button class="btn btn-secondary flex-fill" disabled
                                            style="border-radius:8px; font-size:0.9rem;">
                                        <i class="fas fa-times me-1"></i>Out of Stock
                                    </button>
                                    @Html.ActionLink("View Details", "Details", "Customer", new { id = item.Id },
                                        new
                                             {
                                                 @class = "btn btn-outline-dark",
                                              style = "border-radius:8px; font-size:0.9rem;"
                                             })
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Empty State -->
    @if (!Model.Any())
    {
        <div class="text-center py-5">
            <i class="fas fa-box-open fa-4x text-muted mb-3"></i>
            <h4 class="text-muted">No Products Available</h4>
            <p class="text-muted">Check back later for new products</p>
        </div>
    }
</div>

<style>
    .product-card {
        transition: all 0.3s ease;
    }

        .product-card:hover {
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
            transform: translateY(-5px);
        }

    .size-badge {
        transition: all 0.2s ease;
    }

        .size-badge:hover {
            background-color: #8B0000 !important;
            color: white !important;
            transform: scale(1.05);
        }

    .btn-primary {
        background: linear-gradient(45deg, #8B0000, #A52A2A);
        border: none;
        transition: all 0.3s ease;
    }

        .btn-primary:hover {
            background: linear-gradient(45deg, #A52A2A, #8B0000);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
        }
</style>

@section Scripts {
    @Scripts.Render("~/bundles/jquery")

    <script>
        $(document).ready(function () {
            // Initialize tooltips for size information
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));

            // Product card hover effects
            $('.product-card').hover(
                function () {
                    $(this).css('transform', 'translateY(-5px)');
                },
                function () {
                    $(this).css('transform', 'translateY(0)');
                }
            );

            // Size badges hover effect
            $('.badge.bg-light').hover(
                function () {
                    $(this).css({
                        'background-color': '#8B0000',
                        'color': 'white',
                        'transform': 'scale(1.05)'
                    });
                },
                function () {
                    $(this).css({
                        'background-color': '',
                        'color': '',
                        'transform': 'scale(1)'
                    });
                }
            );
        });
    </script>
}